<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8" [@fadeInDown]>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-5">
    <p-button icon="pi pi-chevron-left" severity="info" [outlined]="true" (click)="goBack()" />
  </div>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-semibold text-gray-900">
            <span [class]="details.requestId ? 'text-gray-900' : 'text-gray-400'">
              {{ details.requestId || "NA" }}
            </span>
          </h2>
          <span class="px-3 py-1 text-sm rounded-full font-bold" [ngClass]="{
              'bg-green-100 text-green-800': details.statusCode === 'SUCCESS',
              'bg-red-100 text-red-800': details.statusCode === 'ERROR',
              'bg-yellow-100 text-yellow-800':
                details.statusCode === 'Processing',
              'bg-blue-100 text-blue-800': !details.statusCode
            }">
            {{ details.statusCode || "Unknown Status" }}
          </span>
        </div>
      </div>

      <div class="px-6 py-2 pb-6">
        <div class="mb-8">
          <h3 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">
            Message Properties
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <div *ngIf="showToast" class="toast-notification" [@fadeInDown]>
                Request ID copied to clipboard!
              </div>

              <div class="flex items-center justify-between mt-1">
                <h3 class="text-sm font-semibold text-gray-500">Request ID</h3>

                <button pButton icon="pi pi-copy" class="ml-2 p-button-text" (click)="copyRequestId()"
                  [disabled]="!details.requestId" aria-label="Copy Request ID"></button>
              </div>

              <p class="text-sm font-medium break-words">
                <span [class]="
                    details.requestId ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.requestId || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">
                Creation Timestamp
              </h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.creationTimestamp
                      ? 'text-gray-900'
                      : 'text-gray-400'
                  ">
                  {{ getFormatDate(details.creationTimestamp) || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Flow Type</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="details.flowType ? 'text-gray-900' : 'text-gray-400'">
                  {{ details.flowType || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Sender BIC</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.senderBic ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.senderBic || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Receiver BIC</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.receiverBic ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.receiverBic || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Status Code</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.statusCode ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.statusCode || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Status Reason</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.statusReason ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.statusReason || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Sender DN</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="details.senderDn ? 'text-gray-900' : 'text-gray-400'">
                  {{ details.senderDn || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">Receiver DN</h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.receiverDn ? 'text-gray-900' : 'text-gray-400'
                  ">
                  {{ details.receiverDn || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">
                Output Message Type
              </h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.outputMessageType
                      ? 'text-gray-900'
                      : 'text-gray-400'
                  ">
                  {{ details.outputMessageType || "NA" }}
                </span>
              </p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <h3 class="text-sm font-semibold text-gray-500">
                Translation Direction
              </h3>
              <p class="mt-1 text-sm font-medium break-words">
                <span [class]="
                    details.translationDirection
                      ? 'text-gray-900'
                      : 'text-gray-400'
                  ">
                  {{ details.translationDirection || "NA" }}
                </span>
              </p>
            </div>
          </div>
        </div>

        <div class="mb-8">
          <h3 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">
            Message Data
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <div class="flex justify-between items-center mb-2">
                <h3 class="text-sm font-semibold text-gray-500">
                  Input Message
                </h3>
                <p-button label="View Full" (click)="showInputDialog()" severity="secondary" [text]="true"
                  icon="pi pi-expand" size="small" />
              </div>
              <div class="preview-container h-72 overflow-auto bg-gray-100 rounded border">
                <pre class="text-sm font-medium text-gray-900 break-words p-2">
                  <code [innerHTML]="prettyPrint(details.inputMessage)"></code>
                </pre>
              </div>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <div class="flex justify-between items-center mb-2">
                <h3 class="text-sm font-semibold text-gray-500">
                  Output Message
                </h3>
                <p-button label="View Full" (click)="showOutputDialog()" severity="secondary" [text]="true"
                  icon="pi pi-expand" size="small" />
              </div>
              <div class="preview-container h-72 overflow-auto bg-gray-100 rounded border">
                <pre class="text-sm font-medium text-gray-900 break-words p-2">
                  <code [innerHTML]="prettyPrint(details.outputMessage)"></code>
                </pre>
              </div>
            </div>
          </div>

          <p-dialog header="Input Message" [(visible)]="inputDialogVisible" [modal]="true" [style]="{ width: '50rem' }"
            [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [maximizable]="true">
            <ng-template pTemplate="header">
              <div class="flex items-center justify-between flex-1">
                <span>Input Message</span>
                <div class="flex items-center">
                  <button pButton type="button" icon="pi pi-download" class="p-button-text p-button-sm"
                    (click)="downloadInputMessage()" *ngIf="details.inputMessage"></button>
                </div>
              </div>
            </ng-template>
            <div class="dialog-content h-[70vh] overflow-auto bg-gray-100 rounded border">
              <pre class="text-sm font-medium text-gray-900 break-words p-2">
                <code [innerHTML]="prettyPrint(details.inputMessage)"></code>
              </pre>
            </div>
          </p-dialog>

          <p-dialog header="Output Message" [(visible)]="outputDialogVisible" [modal]="true"
            [style]="{ width: '50rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [maximizable]="true">
            <ng-template pTemplate="header">
              <div class="flex items-center justify-between flex-1">
                <span>Output Message</span>
                <div class="flex items-center">
                  <button pButton type="button" icon="pi pi-download" class="p-button-text p-button-sm"
                    (click)="downloadOutputMessage()" *ngIf="details.outputMessage"></button>
                </div>
              </div>
            </ng-template>
            <div class="dialog-content h-[70vh] overflow-auto bg-gray-100 rounded border">
              <pre class="text-sm font-medium text-gray-900 break-words p-2">
                <code [innerHTML]="prettyPrint(details.outputMessage)"></code>
              </pre>
            </div>
          </p-dialog>
        </div>

        <div class="mt-8">
          <h3 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">
            Message History
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div *ngFor="let event of details.events"
              class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-semibold text-gray-700">Event ID:
                    <span [class]="event.id ? 'text-gray-900' : 'text-gray-400'">
                      {{ event.id || "NA" }}
                    </span>
                  </span>
                  <span class="px-3 py-2 text-xs font-bold rounded-full uppercase" [ngClass]="{
                      'bg-green-100 text-green-800':
                        event.statusCode === 'SUCCESS',
                      'bg-red-100 text-red-800': event.statusCode === 'Failed',
                      'bg-yellow-100 text-yellow-800':
                        event.statusCode === 'Processing',
                      'bg-blue-100 text-blue-800': !event.statusCode
                    }">
                    <span [class]="
                        event.statusCode ? 'text-inherit' : 'text-gray-400'
                      ">
                      {{ event.statusCode || "NA" }}
                    </span>
                  </span>
                </div>
                <p class="text-sm text-gray-600">
                  <strong>Status Reason:</strong>
                  <span [class]="
                      event.statusReason ? 'text-gray-900' : 'text-gray-400'
                    ">
                    {{ event.statusReason || "NA" }}
                  </span>
                </p>
                <p class="text-sm text-gray-600">
                  <strong>Timestamp:</strong>
                  <span [class]="
                      event.timestamp ? 'text-gray-900' : 'text-gray-400'
                    ">
                    {{ event.timestamp || "NA" }}
                  </span>
                </p>
                <p class="text-sm text-gray-600">
                  <strong>Flow Type:</strong>
                  <span [class]="event.flowType ? 'text-gray-900' : 'text-gray-400'">
                    {{ event.flowType || "NA" }}
                  </span>
                </p>
                <p class="text-sm text-gray-600">
                  <strong>Translation Direction:</strong>
                  <span [class]="
                      event.translationDirection
                        ? 'text-gray-900'
                        : 'text-gray-400'
                    ">
                    {{ event.translationDirection || "NA" }}
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>